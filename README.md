# Проектная работа "Веб-ларек"

## Оглавление

- [Стек технологий](#стек-технологий)
- [Структура проекта](#структура-проекта)
- [Установка и запуск](#установка-и-запуск)
- [Сборка](#сборка)
- [Описание базовых классов](#описание-базовых-классов)
  - [Класс Api](#класс-api)
  - [Класс EventEmitter](#класс-eventemitter)
  - [Класс Component](#класс-component)
  - [Класс Model](#класс-model)
- [Интерфейсы и Типы](#интерфейсы-и-типы)
  - [ICard](#icard)
  - [CategoryType](#categorytype)
  - [CategoryMapping](#categorymapping)
  - [ApiResponse](#apiresponse)
  - [IOrder](#iorder)
  - [IOrderForm](#iorderform)
  - [FormErrors](#formerrors)
  - [IAppStatus](#iappstatus)
- [Список файлов и их назначение](#список-файлов-и-их-назначение)
  - [appStatus](#appstatus)
  - [Basket](#basket)
  - [card](#card)
  - [Contact](#contact)
  - [Form](#form)
  - [larekAPI](#larekapi)
  - [Modal](#modal)
  - [Order](#order)
  - [Page](#page)
  - [Success](#success)
## Стек технологий

![HTML5](https://img.shields.io/badge/html5-%23E34F26.svg?style=for-the-badge&logo=html5&logoColor=white)
![SCSS](https://img.shields.io/badge/scss-%23E50695.svg?style=for-the-badge&logo=css3&logoColor=white)
![JavaScript](https://img.shields.io/badge/javascript-%23323330.svg?style=for-the-badge&logo=javascript&logoColor=%23F7DF1E)
![TypeScript](https://img.shields.io/badge/typescript-%23007ACC.svg?style=for-the-badge&logo=typescript&logoColor=white) 
![Webpack](https://img.shields.io/badge/webpack-%238DD6F9.svg?style=for-the-badge&logo=webpack&logoColor=black)

## Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

____
[Вернуться к оглавлению](#оглавление)

## Описание базовых классов
### Класс `Api`
Предназначен для работы с сервером. Имеет функции получения и отправки данных на сервер.

- readonly baseUrl: string // Содержит ссылку на сервер
- protected options: RequestInit // Необходим для настройки запроса
- handleResponse() // Проверяет ответ от сервера
- get() // Метод для отправки данных на сервер
- post() // Метод для получения данных с сервера

### Класс `EventEmitter`
Предназначен для взаимодействием с событиями.

- on() // Установить обработчик на событие
- off() // Снять обработчик с события
- emit() // Инициировать событие с данными
- onAll() // Слушать все события
- offAll() // Сбросить все обработчики
- trigger() // Сделать коллбек триггер, генерирующий событие при вызове

### Класс `Component`
Предназначен для создания компонентов пользовательского интерфейса.

- toggleClass() // переключает классы
- setText() // устанавливает текстовое содержимое для элемента
- setDisabled() // меняет статус элемента на активный/неактивный
- setHidden() // скрывает элемент
- setVisible() // делает элемент видимым
- setImage() // устанавливает изображение с атрибутом alt
- render() // возвращает DOM-элемент

### Класс `Model`
Данный класс является абстрактным и представляет собой базовую модель. Конструктор принимает следующие аргументы:

- data: Partial // частичные данные
- events: IEvents // события Содержит метод emitChanges(), который оповещает о том, что модель изменилась.

____
[Вернуться к оглавлению](#оглавление)

## Интерфейсы и Типы

### `ICard`
Интерфейс, описывающий карточку товара.

```typescript
export interface ICard {
  id: string;               // Уникальный идентификатор товара
  title: string;            // Название товара
  category: string;         // Категория товара
  description: string;      // Описание товара
  image: string;            // URL изображения товара
  price: number | null;     // Цена товара (может быть null)
  selected: boolean;        // Статус выбора товара
}
```

### `CategoryType`
Тип, описывающий возможные категории товаров.

```typescript
export type CategoryType =
  | 'другое'
  | 'софт-скил'
  | 'дополнительное'
  | 'кнопка'
  | 'хард-скил';
```

### `CategoryMapping`
Тип, отображающий категории на строки.

```typescript
export type CategoryMapping = {
  [Key in CategoryType]: string;
};
```

### `ApiResponse`
Интерфейс, представляющий ответ API.

```typescript
export interface ApiResponse {
  items: ICard[];          // Массив товаров
}
```

### `IOrder`
Интерфейс для описания заказа.

```typescript
export interface IOrder {
  items: string[];         // Массив ID купленных товаров
  address: string;         // Адрес доставки
  email: string;           // Email покупателя
  phone: string;           // Телефон покупателя
  payment: string;         // Метод оплаты
  total: number;           // Общая сумма заказа
}
```

### `IOrderForm`
Интерфейс для формы заказа.

```typescript
export interface IOrderForm {
  address: string;         // Адрес доставки
  email: string;           // Email покупателя
  phone: string;           // Телефон покупателя
  payment: string;         // Метод оплаты
}
```

### `FormErrors`
Тип, представляющий ошибки формы.

```typescript
export type FormErrors = Partial<Record<keyof IOrderForm, string>>;
```

### `IAppStatus`
Интерфейс, описывающий состояние приложения.

```typescript
export interface IAppStatus {
  basket: Product[];                  // Корзина и товары
  store: Product[];                   // Товары в магазине
  order: IOrder;                      // Заказ
  formErrors: FormErrors;             // Ошибки формы

  // Методы управления корзиной
  addToBasket(product: Product): void;        // Добавить товар в корзину
  deleteFromBasket(productId: string): void;  // Удалить товар из корзины
  clearBasket(): void;                        // Очистить корзину
  getBasketAmount(): number;                  // Получить количество товаров в корзине
  getTotalBasketPrice(): number;              // Получить общую сумму корзины

  // Методы для обработки заказа
  setItems(): void;                            // Установить товары для заказа
  setOrderField(field: keyof IOrderForm, value: string): void; // Установить поле заказа
  validateContacts(): boolean;                 // Проверить контактные данные
  validateOrder(): boolean;                    // Проверить заказ
  refreshOrder(): boolean;                     // Обновить заказ

  // Методы для работы с данными
  setStore(items: ICard[]): void;              // Установить товары в магазине
  resetSelected(): void;                       // Сбросить выбранные товары
}
```
____
[Вернуться к оглавлению](#оглавление)

## Список файлов и их назначение

### `appStatus`
Реализовываются классы, которые управляют состоянием приложения для интернет-магазина. Основные элементы и их назначения:

**Класс Product:**

Описывает продукт с такими свойствами, как id, description, image, title, category, price и selected.

**Класс AppState:**

Хранит состояние приложения, включая:

| Элемент      | Описание                                                                                                              |
| :----------: |:---------------------------------------------------------------------------------------------------------------------:|
| basket       | массив продуктов, добавленных в корзину                                                                               |
| store        | массив всех доступных продуктов                                                                                       |
| order        | объект, представляющий заказ клиента, с полями для хранения информации о товарах, способах оплаты и контактных данных |
| formErrors   | объект для хранения ошибок валидации форм                                                                             |

**Методы класса AppState:**

| Элемент                         | Описание                                                                            |
| :-----------------------------: |:-----------------------------------------------------------------------------------:|
| addToBasket                     | добавляет продукт в корзину                                                         |
| deleteFromBasket                | удаляет продукт из корзины по его идентификатору                                    |
| clearBasket                     | очищает корзину                                                                     |
| getBasketAmount                 | возвращает количество товаров в корзине                                             |
| setItems                        | обновляет список товаров в заказе на основе содержимого корзины                     |
| setOrderField                   | устанавливает значение поля заказа и выполняет валидацию контактных данных и заказа |
| validateContacts и validateOrder| проверяют корректность заполнения контактных данных и полей заказа, соответственно  |
| refreshOrder                    | сбрасывает объект заказа до начального состояния                                    |
| getTotalBasketPrice             | вычисляет общую стоимость товаров в корзине                                         |
| setStore                        | устанавливает список продуктов в магазине и генерирует событие об изменениях        |
| resetSelected                   | сбрасывает выбор для всех товаров в магазине                                        |

____
[Вернуться к оглавлению](#оглавление)
____
### `Basket`
Реализовывается функциональность корзины товаров в веб-приложении. Основные элементы кода:
| Элемент           | Описание                                                                                       |
| :---------------: |:----------------------------------------------------------------------------------------------:|
| Интерфейс IBasket | Определяет структуру корзины, включая список товаров (в виде элементов HTML) и общую стоимость |
| Класс Basket      | Наследует от класса Component и управляет отображением корзины                                 |

**Класс Basket**
- Инициализацию элементов (списка товаров, цены, кнопки).
- Обработчик события на кнопку оформления заказа, который вызывает событие basket:order.
- Методы для обновления списка товаров и общей стоимости, а также для отключения кнопки оформления заказа.
- Метод для обновления индексов товаров после их удаления.

| Элемент                                             | Описание                                                                                  |
| :-----------------------------------------------:   |:-----------------------------------------------------------------------------------------:|
| Интерфейсы IProductBasket и IStoreItemBasketActions | Определяют структуру товара в корзине и действия с элементами корзины (например, нажатие на кнопку удаления) |

**Класс StoreItemBasket:**
Управляет отдельным товаром в корзине. Он включает:

- Инициализацию элементов (название, индекс, цена, кнопка удаления).
- Обработчик нажатия на кнопку удаления, который удаляет элемент из DOM и вызывает обработчик клика, если он задан.
- Сеттеры для обновления названия, индекса и цены товара.
____
[Вернуться к оглавлению](#оглавление)
____
### `card`

Реализовывается компонент карточки товара для веб-приложения, а также его расширенные версии. Основные части кода:
| Элемент           | Описание                                                                                       |
| :---------------: |:----------------------------------------------------------------------------------------------:|
| Интерфейс IActions | Определяет действия, которые могут быть выполнены при нажатии на карточку (например, обработчик события клика) |
| Класс Basket      | Наследует от класса Component и управляет отображением корзины                                 |
| Класс Card        | Основной класс, который наследует от Component и отвечает за отображение карточки товара       |

**Класс Card.** Основные функции:
- Инициализация элементов карточки (название, категория, изображение, цена, кнопка) с помощью методов, которые обеспечивают наличие этих элементов.
- Обработчик нажатия на кнопку или на карточку, если кнопка отсутствует.
- Сеттеры и геттеры для уникального идентификатора, названия, изображения, состояния кнопки (выбрана или нет), цены и категории товара. Сеттеры обновляют соответствующие элементы DOM.

| Элемент           | Описание                                                                                       |
| :---------------: |:----------------------------------------------------------------------------------------------:|
| Классы StoreItem и StoreItemPreview | Определяет действия, которые могут быть выполнены при нажатии на карточку (например, обработчик события клика) |

____
[Вернуться к оглавлению](#оглавление)
____
### `Contact`

Реализовывается компонент окошка контактов, позволяя пользователям вводить контактные данные, такие как телефон и электронная почта. Вот основные элементы кода:
| Элемент           | Описание                                                                                       |
| :---------------: |:----------------------------------------------------------------------------------------------:|
| Интерфейс IContact | Определяет структуру контактной информации с двумя полями — phone и email |
| Класс Contact | Наследует от класса Form, что позволяет ему использовать функциональность формы |

**Класс Contact**Основные функции:

Конструктор принимает элемент формы (родительский элемент) и обработчик событий (events), обеспечивая интеграцию с другими компонентами приложения.
____
[Вернуться к оглавлению](#оглавление)
____
### `Form`
Реализовывается базовый компонент формы в веб-приложении, обеспечивая управление состоянием и обработку событий. Основные элементы кода:
| Элемент           | Описание                                                                                       |
| :---------------: |:----------------------------------------------------------------------------------------------:|
| Интерфейс IFormState | Определяет структуру состояния формы, включая два поля — valid (валидность формы) и errors (массив ошибок) |
| Класс Form | Наследует от класса Component и предоставляет функциональность для работы с формами |

**Класс Form** Основные функции:

Конструктор: Инициализирует элементы формы (кнопка отправки и элемент для отображения ошибок) и добавляет обработчики событий для ввода и отправки формы.
Обработчик события input следит за изменениями в полях ввода и вызывает метод onInputChange.
Обработчик события submit предотвращает стандартное поведение формы и вызывает событие отправки с помощью this.events.emit.
Метод onInputChange: Вызывается при изменении значения в полях ввода, эмитируя событие orderInput:change, чтобы сообщить об изменении.

Сеттеры для состояния формы:

valid: Устанавливает состояние кнопки отправки (активна/неактивна) в зависимости от валидности формы.
errors: Обновляет отображение ошибок в форме.
Метод render: Обновляет состояние формы, переданное в виде объекта, и вызывает метод родительского класса для отрисовки.
____
[Вернуться к оглавлению](#оглавление)
____
### `larekAPI`

Реализовывается API-класс для взаимодействия с сервером, предоставляя методы для получения списка товаров, получения информации о конкретном товаре и оформления заказов. Основные элементы кода:

Интерфейс ILarekAPI: Определяет методы, которые должен реализовать класс LarekAPI:

getItemList: Получение списка товаров.
getItem: Получение информации о конкретном товаре по его идентификатору.
orderItems: Отправка заказа на сервер.
Класс LarekAPI: Наследует от класса Api и реализует интерфейс ILarekAPI. Основные функции:

Конструктор: Принимает базовый URL и CDN для загрузки изображений, передавая их в родительский класс.
Метод getItemList: Выполняет HTTP-запрос для получения списка продуктов. После получения данных обрабатывает их, добавляя к каждому элементу полный путь к изображению.
Метод getItem: Выполняет запрос для получения информации о конкретном товаре, также добавляя полный путь к изображению.
Метод orderItems: Отправляет заказ на сервер и возвращает данные о заказе.
____
[Вернуться к оглавлению](#оглавление)
____
### `Modal`

Реализовывается компонент модального окна, позволяя отображать контент поверх основного интерфейса приложения. Основные элементы кода:

Интерфейс IModalData: Определяет структуру данных, необходимых для модального окна, включая поле content, которое представляет содержимое модала.

Класс Modal: Наследует от класса Component и управляет отображением модального окна. Основные функции:

Конструктор: Инициализирует элементы модального окна (кнопка закрытия и контейнер для контента) и устанавливает обработчики событий:
Обработчик для кнопки закрытия, который вызывает метод close.
Обработчик для всего контейнера модала, который также закрывает модал при клике вне контента.
Обработчик на контенте, который предотвращает закрытие модала при клике внутри него.
Сеттер content: Позволяет обновлять содержимое модального окна, заменяя его новым элементом.

Методы open и close:

open(): Добавляет класс, активирующий отображение модала, и эмитирует событие modal:open.
close(): Убирает класс, отключающий отображение модала, очищает содержимое и эмитирует событие modal:close.
____
[Вернуться к оглавлению](#оглавление)
____
### `Order`
Реализовывается компонент окна для оформления заказа товара в веб-приложении. Основные элементы кода:

Интерфейс IOrder: Определяет структуру данных, связанных с заказом, включая поля address (адрес доставки) и payment (способ оплаты).

Класс Order: Наследует от класса Form и управляет логикой формы для оформления заказа. Основные функции:

Конструктор: Принимает имя блока, элемент формы и обработчик событий, и инициализирует элементы управления:
Получает ссылки на кнопки оплаты (_card и _cash) по их именам.
Устанавливает обработчики событий для каждой кнопки, которые активируют соответствующую кнопку и обновляют состояние выбора способа оплаты с помощью метода onInputChange.
Метод disableButtons: Отключает выделение (подсвечивание) выбранных кнопок, сбрасывая классы, которые активируют визуальное отображение.
____
[Вернуться к оглавлению](#оглавление)
____
### `Page`
Реализовывается компонент главной страницы веб-приложения, отвечающий за отображение товаров и управление состоянием корзины. Основные элементы кода:

Интерфейс IPage: Определяет структуру данных, необходимых для страницы, включая:

counter: количество товаров в корзине.
store: массив элементов карточек товаров.
locked: флаг, указывающий, заблокирована ли прокрутка страницы.
Класс Page: Наследует от класса Component и управляет отображением главной страницы. Основные функции:

Конструктор: Принимает элемент контейнера и обработчик событий, инициализирует ссылки на важные элементы страницы (счетчик, блок с товарами, обертка страницы и корзина).
Устанавливает обработчик событий для элемента корзины, который вызывает событие basket:open при клике, позволяя открыть корзину.
Сеттеры:

counter: Обновляет текст в элементе счетчика, отображая количество товаров в корзине.
store: Заменяет текущие карточки товаров новыми, которые передаются в виде массива HTML-элементов.
locked: Управляет классом, блокирующим прокрутку страницы, добавляя или удаляя класс page__wrapper_locked.
____
[Вернуться к оглавлению](#оглавление)
____
### `Success`
Реализовывается компонент успешного завершения операции (например, успешного оформления заказа) в веб-приложении. Основные элементы кода:

Интерфейс ISuccessActions: Определяет действия, которые можно выполнить с компонентом, в данном случае это обработчик клика для кнопки.

Интерфейс ISuccess: Определяет свойства, которые использует компонент, включая description, представляющую описание как числовое значение.

Класс Success: Наследует от класса Component и управляет отображением информации об успешном завершении операции. Основные функции:

Конструктор: Принимает имя блока, элемент контейнера и опциональные действия. Внутри конструктора:
Инициализируются ссылки на кнопку закрытия и элемент описания.
Если передан обработчик событий onClick, он добавляется к кнопке закрытия.
Сеттер description: Позволяет обновлять текст в элементе описания, форматируя числовое значение с помощью функции handlePrice, добавляя текст "Списано" перед отформатированным значением.
____
[Вернуться к оглавлению](#оглавление)